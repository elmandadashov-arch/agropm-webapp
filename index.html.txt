<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Agro PM Finance</title>
  <link rel="manifest" href="manifest.json">
</head>
<body style="font-family: Arial; padding:20px">

<h2>AGRO PM JURNAL</h2>

<input id="api" placeholder="API URL-ni buraya yapışdır" style="width:100%" />
<button onclick="saveApi()">API Saxla</button>

<hr>

<h3>Yeni Əməliyyat</h3>

<input id="nov" placeholder="Növ (MƏDAXİL/MƏXARİC)" style="width:100%" /><br><br>
<input id="mebleg" placeholder="Məbləğ" style="width:100%" /><br><br>
<input id="aciqlama" placeholder="Açıqlama" style="width:100%" /><br><br>

<button onclick="add()">Əlavə et</button>

<hr>

<h3>Son əməliyyatlar</h3>
<button onclick="load()">Yenilə</button>

<pre id="out"></pre>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js');
}

document.getElementById("api").value =
  localStorage.getItem("API_URL") || "";

function saveApi(){
  localStorage.setItem("API_URL",
  document.getElementById("api").value);
  alert("API saxlanıldı");
}

function api(){
  return localStorage.getItem("API_URL");
}

async function load(){
  const res = await fetch(api()+"?action=list&limit=10");
  const data = await res.json();
  document.getElementById("out").textContent =
    JSON.stringify(data, null, 2);
}

async function add(){
  const payload = {
    action:"add",
    data:{
      Tarix: new Date().toISOString(),
      Növ: document.getElementById("nov").value,
      Məbləğ: document.getElementById("mebleg").value,
      Açıqlama: document.getElementById("aciqlama").value
    }
  };

  await fetch(api(),{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify(payload)
  });

  alert("Əlavə olundu");
  load();
}
</script>

</body>
</html>